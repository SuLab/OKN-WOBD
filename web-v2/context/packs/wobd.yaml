id: wobd
label: "WOBD"
description: "WOBD-selected graphs for biomedical data discovery"
version: "0.1.0"

endpoint_mode:
  default: federated
  federated_endpoint: "https://frink.apps.renci.org/federation/sparql"
  direct_endpoints:
    nde: "https://frink.apps.renci.org/nde/sparql"
    gene-expression-atlas-okn: "https://frink.apps.renci.org/gene-expression-atlas-okn/sparql"
    spoke-okn: "https://frink.apps.renci.org/spoke-okn/sparql"
    ubergraph: "https://frink.apps.renci.org/ubergraph/sparql"

graphs:
  default_shortnames: ["nde", "ubergraph"]
  allow_user_select: true

prefixes:
  schema: "http://schema.org/"
  rdf: "http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  rdfs: "http://www.w3.org/2000/01/rdf-schema#"
  obo: "http://purl.obolibrary.org/obo/"

# Guardrails: limits and safety for SPARQL execution and chat UI.
# - max_limit: cap on LIMIT in generated queries (500).
# - timeout_seconds: default request timeout (25s); GXA direct uses 120s.
# - max_rows_download: cap on rows when downloading results (2000).
# - forbid_ops: SPARQL operations rejected by validator (no write ops).
# GEO data is in the NDE graph (same schema.org as ImmPort etc.); use geo_dataset_search to search GEO only.
guardrails:
  max_limit: 500
  timeout_seconds: 25
  max_rows_download: 2000
  allow_raw_sparql: true
  allow_open_nl2sparql: true
  allow_service: true
  service_policy: "allow_any_frink"
  service_allowlist: []
  forbid_ops: ["INSERT", "DELETE", "LOAD", "CLEAR", "DROP", "CREATE", "MOVE", "COPY", "ADD"]

templates:
  - id: drug_datasets
    description: "Find NDE datasets for diseases treated by a drug. Optionally restrict to GEO/gene expression and include GXA/SPOKE-GeneLab links for matching experiments."
    required_slots: ["drug"]
    optional_slots: ["only_gene_expression", "max_results"]
  - id: dataset_search
    description: "Find datasets by keywords/healthCondition"
    required_slots: ["keywords"]  # At least one keyword required for the simple search form
  - id: geo_dataset_search
    description: "Find NCBI GEO datasets in NDE by keywords, disease, or organism"
    required_slots: ["keywords"]
  - id: entity_lookup
    description: "Resolve CURIE/URI/label to entity"
    required_slots: ["q"]
  - id: gene_expression_dataset_search
    description: "List gene expression experiments (datasets) that have differential expression results"
    required_slots: []
    optional_slots: ["organism_taxon_ids", "tissue_uberon_ids_ols", "factor_terms", "disease_efo_ids"]
  - id: gene_expression_genes_in_experiment
    description: "List differentially expressed genes for a given gene expression experiment (per contrast)"
    required_slots: ["experiment_id"]
    optional_slots: ["organism_taxon_ids", "tissue_uberon_ids_ols", "factor_terms", "min_abs_log2fc", "max_adj_p_value"]
  - id: gene_expression_experiments_for_gene
    description: "Find gene expression experiments/contrasts where a gene is differentially expressed"
    required_slots: ["gene_symbols"]
    optional_slots: ["organism_taxon_ids", "tissue_uberon_ids_ols", "factor_terms"]
  - id: gene_expression_gene_cross_dataset_summary
    description: "Summarize a gene's DE evidence across experiments (per contrast)"
    required_slots: ["gene_symbol"]
    optional_slots: ["organism_taxon_ids", "tissue_uberon_ids_ols", "factor_terms"]
  - id: gene_expression_genes_agreement
    description: "Find genes DE in the same direction across multiple experiments"
    required_slots: []
    optional_slots: ["min_experiments", "direction", "limit", "organism_taxon_ids", "tissue_uberon_ids_ols", "factor_terms"]
  - id: gene_expression_genes_discordance
    description: "Find genes DE in opposite directions across contrasts"
    required_slots: []
    optional_slots: ["organism_taxon_ids", "tissue_uberon_ids_ols", "factor_terms"]

schema_hints:
  example_queries:
    - "SELECT ?dataset ?name WHERE { ?dataset a schema:Dataset ; schema:name ?name } LIMIT 10"
  common_predicates:
    - "schema:name"
    - "schema:description"
    - "schema:healthCondition"
    - "schema:species"

intent_routing:
  default_lane: "template"
  open_query_threshold: 0.55

graphs_metadata:
  - id: nde
    description: "NIAID biomedical datasets"
    good_for: ["dataset_search"]
    uses_ontologies: ["MONDO", "NCBITaxon"]
    queryable_by:
      - entity_type: "Disease"
        property: "schema:healthCondition"
      - entity_type: "Species"
        property: "schema:species"
  
  - id: ubergraph
    description: "Merged biomedical ontologies"
    good_for: ["entity_lookup", "ontology_reasoning"]
    # provides_ontologies is defined in context/graphs/ubergraph.yaml with full list

  - id: gene-expression-atlas-okn
    description: "Gene Expression Atlas (GXA) differential expression and contrasts"
    good_for: ["dataset_search", "gene_expression_coverage", "gene_de_for_dataset", "datasets_for_gene_de"]
    uses_ontologies: ["NCBITaxon", "UBERON", "EFO"]
    queryable_by:
      - entity_type: "Disease"
        property: "studies (Study â†’ EFO)"
      - entity_type: "Gene"
        property: "biolink:object (GeneExpressionMixin)"

